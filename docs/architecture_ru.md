#  Хранение информации

Хранение информации реализовано в виде папки на диске со следующей структурой:

```
├───attachment
│   ├───note1.pdf
│   └───note2.doc
├───images
│   ├───1.bmp
│   └───2.jpg
├───languages
│   └───ru_RU.json
├───base.sqlite
└───struct.json
```

**attachment** - папка с вложениями, вложения могут быть любыми (с оговоркой что хорошо бы что-то не слишком экзотическое чтобы со временем сделать экспорт) и открываются во внешних программах. Назначение данной сущности - нечто наподобие заметок, например, статья как отличать монеты Елизаветы разных дворов друг от друга или скан заключения ГИМа. Возможно, со временем будет возможность делать ко множеству сущностей (типов-вариантов)

**images** - папка с картинками, в целом аналогичны вложениям (как видно из диаграмы, таблицы в базе имеют одинаковую структуру), но будут показываться прямо в программе. В качестве идентификатора в таблице и имени будет md5-сумма файла

**languages** - папка с переводами. Не то чтобы я пытался замахнуться на продукт с международным использованием, просто проще всего сматчить названия полей в таблице на английском прямо в название полей в интерфейсе чем делать отдельно подписи и следить чтобы ничего не перепуталось.

**base.sqlite** - основное хранилище данных, база sqlite

**struct.json** - заданет связи таблиц друг с другом и некоторые другие нужные для ГУЯ вещи (откуда брать данные для комбобоксов, что выводить в списке и т.п.). Причина пояления - хотелось менять некоторые параметры без перекомпиляции программы, пока не знаю сохранится ли он в дальнейшем

## Структура БД

При создании базы практически не были использованы триггеры и перенос повторяющихся данных в отдельные таблицы - на мой взгляд, слишком небольшой объем базы в целом и этих данных чтобы так усложнять структуру, особенно учитывая отсутствие переменных в тригерах sqlite и во что из-за этого превращается их код

Диаграмма сделана при помощи [DbVisualizer](http://www.dbvis.com/) и лежит рядом. Ниже перечисляю таблицы с их описанием, поля названы более-менее адекватно и потому описывать буду только что-то не очевидное

**Types** - если можно так выразиться, данная таблица это точка входа в базу, именно с нее и начинается вся работа. Она содержит в себе список монетных типов и их описание. Единственное неочевидное поле это issue - тип выпуска: "общегосударственный", "сибирская монета" и т.п.

**Variaties** - разновидности монет, varityType это тип разновидности - обычная, ложная (например, случайно получившаяся из-за выкрошки дата когда монет не чеканили), фальшивка, фуфло, новодел, спорная (используется когда не вполне понятнл что это - причуда выкрошки, подделка или еще что). ~~ Таблица не содержит описания аверсов-реверсов т.к. они описаны в следующих таблицах ~~

~~**ReversAttribute** и **AversAttribute** - описание особенностей аверсов и реверсов в виде длинного списка ключ-значение, например, \["орел":"обр. 1730";"на короне":"навершие от скипетра";"крест державы":"простой"\] . По хорошему надо сделать доптаблицу для каждой чтобы, во-первых, не вовторять по многу раз одно и то же, а, во-вторых, иметь возможность комментировать или же добавлять картинку для конкретной черты для наглядности, но это когда-нибудь потом~~ сейчас таких таблиц в поле нет, данная информация включена в Variaties в виде текстовых полей. Причина - переусложнение базы при том что почти того же можно добиться просто перечисляя признаки чере точку с запятой

                            
**ConcreteCoins** - список монет (конкретных экземпляров). Поле status это грубо говоря то где сейчас монета и что она в базе делает, лежит в коллекции, в обменном фонде или же просто что-то интересное и это "архивная" запись

**CoinHistory** - провенанс, откуда есть пошла монета

**SourcesList** - ссылка на возможные источники

**varReferences** - ссылка на каталоги и прочие источники для монеты в виде источник - номер -редкость -комментарий

**Features** - это интересные особенности которыми может обладать определенная монета и которые могут идти дополнением к разновидностям, пример таких особенностей - перечекан из рамки или гладкий гурт у денег обр. 1730, дробный перечекан у двушек в 1770-х. Не сложно понять что включение особенности именно в эту таблицу, а не в описание конкретной монеты носит субьективный характер, само же наличие таблицы несет под собой желание как-то подсветить ту или иную особенность. Для себя я выделяю следующие причины для включения:

* Включение монеты в каталоги в качестве отдельной разновидности, пример - уже упомянутый гладкий гурт на деньгах - есть почти во всех каталогах хотя по сути является браком и может быть дополнением к абсолютно любой другой разновидности
* Желание подсветить определенный факт носящий элемент случайности, примеры - дробный перечекан или перечекан ВРП на боратинке, при этом перечекан копеек из шведов сюда не попадает т.к. носит массовый характер и жестко завязан на определенные разновидности

От данной таблицы можно перейти к конкретным монетам (эта связь задана таблицей **CoinFeature**), но нельзя их добавить - у монеты всегда должна быть главная разновидность из таблицы Variaties

**Images** и **Notes** - таблицы с картинками и вложениями, связь с прочими данными задается в программе (не в базе) через поля relid и table, так странно чтобы не плодить сущности - иначе надо таких таблиц делать много

**FullReversDescription**, **FullAversDescription** и **FullVariatiesView** - служебные представления, первые два склеивают описание аверса или реверса в одну строку из кучи пар, третье выбирает их для варианта. Служат для отображения красивого списка. 

В качестве идентификатора в большинстве таблиц используются GUID'ы чтобы модно было безболезнено сливать данные от разных источников. Исключением являются:

* Список источников - в качестве идентификатора используется человекочитаемое сокращение, например, "ВКГМ" или "Уздеников"
* Картинки -